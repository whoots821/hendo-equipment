<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hendo Equipment</title>
  <meta name="description" content="Hendo Equipment - attachments, buckets, grapples and more." />

  <style>
    :root{
      --bg:#f6f6f6;
      --card:#ffffff;
      --text:#111;
      --muted:#666;
      --border:#e6e6e6;
      --shadow: 0 1px 14px rgba(0,0,0,.06);
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    header{
      background:#111;
      color:#fff;
      padding:18px 18px;
    }
    header .wrap{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
    }
    header h1{
      font-size:18px;
      margin:0;
      letter-spacing:.3px;
    }
    header nav a{
      color:#fff;
      text-decoration:none;
      opacity:.9;
      margin-left:12px;
      font-weight:600;
      font-size:14px;
    }
    header nav a:hover{ opacity:1; text-decoration:underline; }

    main{
      max-width:1100px;
      margin:0 auto;
      padding:20px 18px 36px;
    }

    .hero{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:18px;
      margin-bottom:16px;
    }
    .hero h2{ margin:0 0 6px; font-size:18px; }
    .hero p{ margin:0; color:var(--muted); }

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin: 14px 0 16px;
    }
    .btn{
      padding:10px 12px;
      border-radius: 999px;
      border: 1px solid #ddd;
      background:#fff;
      cursor:pointer;
      font-weight:700;
      font-size:13px;
      transition: .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.active{
      background:#111;
      color:#fff;
      border-color:#111;
    }

    .tiles{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap:14px;
    }
    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:14px;
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 160px;
    }
    .title{
      font-weight:800;
      font-size:16px;
    }
    .controls{
      display:grid;
      gap:10px;
    }
    select{
      width:100%;
      padding:10px;
      border-radius: 10px;
      border:1px solid #ddd;
      background:#fff;
      font-weight:600;
    }
    .priceRow{
      display:flex;
      justify-content:space-between;
      align-items:baseline;
      gap:10px;
    }
    .priceLabel{ color:var(--muted); font-weight:600; }
    .priceValue{ font-weight:900; font-size:18px; }
    .skuLine{
      color: var(--muted);
      font-size:12px;
      min-height: 16px;
    }
    .quote{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #111;
      background:#fff;
      cursor:pointer;
      font-weight:800;
    }
    .quote:disabled{
      opacity:.45;
      cursor:not-allowed;
    }

    .status{
      margin-top:10px;
      color: var(--muted);
      font-size: 13px;
    }

    footer{
      text-align:center;
      color: var(--muted);
      padding: 22px 10px;
      font-size: 13px;
    }
    code.inline{
      background:#fff;
      border:1px solid var(--border);
      padding:2px 6px;
      border-radius:8px;
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <h1>Hendo Equipment</h1>
      <nav>
        <a href="#catalog">Products</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main>
    <section class="hero">
      <h2>Attachments & Pricing</h2>
      <p>Select a category (Excel tab), then choose duty + width to see price update instantly.</p>
      <div class="status" id="status">Loading catalog…</div>
    </section>

    <section id="catalog">
      <div class="bar" id="categoryBar"></div>
      <div class="tiles" id="tiles"></div>
    </section>

    <section id="contact" class="hero" style="margin-top:16px;">
      <h2>Contact</h2>
      <p>
        Want a quote? Use <code class="inline">Request quote</code> on a tile or contact us directly.
      </p>
      <p style="margin-top:10px; color:var(--muted);">
        Update the email address in the code where it says <code class="inline">hendosales@example.com</code>.
      </p>
    </section>
  </main>

  <footer>
    © <span id="year"></span> Hendo Equipment
  </footer>

  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

  <script>
    (async function () {
      // ✅ Put hendo_catalog.json here in your repo:
      // /data/hendo_catalog.json
      // GitHub Pages will then serve it at:
      // https://whoots821.github.io/hendo-equipment/data/hendo_catalog.json
      const DATA_URL = "./data/hendo_catalog.json";

      const statusEl = document.getElementById("status");
      const categoryBar = document.getElementById("categoryBar");
      const tilesEl = document.getElementById("tiles");

      function slugify(s) {
        return String(s || "")
          .toLowerCase()
          .replace(/&/g, "and")
          .replace(/[^a-z0-9]+/g, "-")
          .replace(/^-+|-+$/g, "");
      }

      function money(n) {
        const num = Number(n);
        if (!Number.isFinite(num)) return "";
        return "$" + Math.round(num).toLocaleString();
      }

      function uniqueSorted(arr) {
        return [...new Set(arr.filter(Boolean))].sort((a, b) => {
          const na = Number(a), nb = Number(b);
          if (Number.isFinite(na) && Number.isFinite(nb)) return na - nb;
          return String(a).localeCompare(String(b));
        });
      }

      function getVariant(item, duty, width) {
        const key = `${duty || ""}|${String(width || "")}`;
        return (item.lookup && item.lookup[key]) ? item.lookup[key] : null;
      }

      function renderCategoryButtons(categories, activeSlug) {
        categoryBar.innerHTML = "";
        categories.forEach(cat => {
          const btn = document.createElement("button");
          btn.className = "btn" + (cat.slug === activeSlug ? " active" : "");
          btn.textContent = cat.name;
          btn.onclick = () => setActiveCategory(cat.slug);
          categoryBar.appendChild(btn);
        });
      }

      function tileTemplate(item) {
        const card = document.createElement("div");
        card.className = "card";

        const title = document.createElement("div");
        title.className = "title";
        title.textContent = item.name || "Item";

        const duties = uniqueSorted((item.variants || []).map(v => v.duty));
        const widths = uniqueSorted((item.variants || []).map(v => v.width));

        const controls = document.createElement("div");
        controls.className = "controls";
        controls.style.gridTemplateColumns = duties.length ? "1fr 1fr" : "1fr";

        let dutySelect = null;
        if (duties.length) {
          dutySelect = document.createElement("select");
          dutySelect.innerHTML =
            `<option value="">Select duty</option>` +
            duties.map(d => `<option value="${d}">${d}</option>`).join("");
          controls.appendChild(dutySelect);
        }

        const widthSelect = document.createElement("select");
        widthSelect.innerHTML =
          `<option value="">Select width</option>` +
          widths.map(w => `<option value="${w}">${w}"</option>`).join("");
        controls.appendChild(widthSelect);

        const priceRow = document.createElement("div");
        priceRow.className = "priceRow";

        const priceLabel = document.createElement("div");
        priceLabel.className = "priceLabel";
        priceLabel.textContent = "Price:";

        const priceValue = document.createElement("div");
        priceValue.className = "priceValue";
        priceValue.textContent = "Select options";

        priceRow.appendChild(priceLabel);
        priceRow.appendChild(priceValue);

        const skuLine = document.createElement("div");
        skuLine.className = "skuLine";

        const quoteBtn = document.createElement("button");
        quoteBtn.className = "quote";
        quoteBtn.textContent = "Request quote";
        quoteBtn.disabled = true;

        let selectedVariant = null;

        function updatePrice() {
          const duty = dutySelect ? dutySelect.value : "";
          const width = widthSelect.value;

          selectedVariant = getVariant(item, duty, width);

          if (selectedVariant) {
            priceValue.textContent = money(selectedVariant.price);
            skuLine.textContent = selectedVariant.sku ? ("SKU: " + selectedVariant.sku) : "";
            quoteBtn.disabled = false;
          } else {
            priceValue.textContent = "Select options";
            skuLine.textContent = "";
            quoteBtn.disabled = true;
          }
        }

        if (dutySelect) dutySelect.addEventListener("change", updatePrice);
        widthSelect.addEventListener("change", updatePrice);

        quoteBtn.addEventListener("click", () => {
          if (!selectedVariant) return;

          // ✅ CHANGE THIS EMAIL:
          const TO_EMAIL = "hendosales@example.com";

          const subject = encodeURIComponent(`Quote request: ${item.name}`);
          const body = encodeURIComponent(
            `Hi Hendo Equipment,\n\n` +
            `I’d like a quote for:\n` +
            `Item: ${item.name}\n` +
            (selectedVariant.duty ? `Duty: ${selectedVariant.duty}\n` : "") +
            `Width: ${selectedVariant.width}"\n` +
            (selectedVariant.sku ? `SKU: ${selectedVariant.sku}\n` : "") +
            `Price shown: ${money(selectedVariant.price)}\n\n` +
            `Name:\nPhone:\nLocation:\n\nThanks!`
          );

          window.location.href = `mailto:${TO_EMAIL}?subject=${subject}&body=${body}`;
        });

        card.appendChild(title);
        card.appendChild(controls);
        card.appendChild(priceRow);
        card.appendChild(skuLine);
        card.appendChild(quoteBtn);

        return card;
      }

      let CATEGORIES = [];
      let ACTIVE = null;

      function renderTiles(categorySlug) {
        const cat = CATEGORIES.find(c => c.slug === categorySlug);
        tilesEl.innerHTML = "";
        if (!cat) return;

        (cat.items || []).forEach(item => {
          tilesEl.appendChild(tileTemplate(item));
        });
      }

      function setActiveCategory(slug) {
        ACTIVE = slug;
        renderCategoryButtons(CATEGORIES, ACTIVE);
        renderTiles(ACTIVE);

        try { localStorage.setItem("hendo_active_category", ACTIVE); } catch (e) {}
      }

      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status + " loading catalog JSON");

        const catalog = await res.json();

        // categories are your Excel tabs (All_Items is already excluded in the JSON)
        CATEGORIES = (catalog.categories || []).map(c => ({
          ...c,
          slug: c.slug || slugify(c.name)
        }));

        if (!CATEGORIES.length) {
          statusEl.textContent = "No categories found in catalog JSON.";
          return;
        }

        const saved = (() => {
          try { return localStorage.getItem("hendo_active_category"); }
          catch (e) { return null; }
        })();

        const first = CATEGORIES[0].slug;
        statusEl.textContent = "Loaded. Choose a category to view products.";
        setActiveCategory(saved && CATEGORIES.some(c => c.slug === saved) ? saved : first);

      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Could not load catalog JSON. " +
          "Make sure you uploaded /data/hendo_catalog.json to your repo. " +
          "Error: " + (err && err.message ? err.message : err);
      }
    })();
  </script>
</body>
</html>
