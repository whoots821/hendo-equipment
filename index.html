<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Hendo Equipment | Attachments & Pricing</title>

<style>
:root{
  --bg:#f4f6f4;--panel:#fff;--panelAlt:#eef2ee;--text:#0f172a;
  --muted:#475569;--border:#d1d5db;--accent:#6b7f3a;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
.container{max-width:1200px;margin:0 auto;padding:16px}

header{background:#fff;border-bottom:4px solid var(--accent)}
.headerRow{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
.brand h1{margin:0;font-size:22px}
.badgeRow{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap}
.badge{padding:6px 10px;border-radius:999px;background:var(--panelAlt);
  border:1px solid var(--border);font-size:12px;font-weight:900}

.btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);
  background:#fff;font-weight:900;cursor:pointer;text-decoration:none;display:inline-block}
.btnPrimary{background:var(--accent);color:#fff;border:none}

.layout{display:grid;grid-template-columns:260px 1fr;gap:16px;margin-top:16px}
@media(max-width:900px){.layout{grid-template-columns:1fr}}

.sidebar{background:#fff;border:1px solid var(--border);border-radius:14px;padding:12px}
.sideTitle{font-weight:900;color:var(--accent);margin-bottom:8px}

.machineTabs button,
.catBtn{
  width:100%;text-align:left;padding:10px;border-radius:8px;
  border:1px solid var(--border);background:#fff;font-weight:900;
  cursor:pointer;margin-bottom:6px
}
.machineTabs button.active,
.catBtn.active{background:var(--panelAlt);border-color:var(--accent)}

.content{background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px}

.pageTitle{display:flex;flex-direction:column;gap:4px;margin-bottom:10px}
.pageTitle h2{margin:0;font-size:18px}
.pageTitle .small{font-size:12px;color:var(--muted)}

.tilesGrid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
  gap:12px;
  margin-top:12px;
}
.tile{
  border:1px solid var(--border);
  border-radius:14px;
  background:#fff;
  overflow:hidden;
}
.tileHead{
  padding:12px;
  background:var(--panelAlt);
  border-bottom:1px solid var(--border);
}
.tileHead .name{font-weight:1000}
.tileBody{padding:12px;display:grid;gap:10px}
.filters{display:flex;gap:10px;flex-wrap:wrap}
.field label{font-size:12px;font-weight:900;color:var(--muted)}
select{padding:10px;border-radius:8px;border:1px solid var(--border);min-width:160px}

.priceBig{font-size:22px;font-weight:1100}
.small{font-size:12px;color:var(--muted)}

footer{margin-top:24px;border-top:1px solid var(--border);background:#fff}
</style>
</head>

<body>
<header>
  <div class="container headerRow">
    <div class="brand">
      <h1>Hendo Equipment</h1>
      <div class="badgeRow">
        <span class="badge">ðŸ‡ºðŸ‡¸ USA Made</span>
        <span class="badge">Veteran Owned & Operated</span>
      </div>
    </div>
    <div>
      <a class="btn btnPrimary" href="tel:+18286990157">(828) 699-0157</a>
    </div>
  </div>
</header>

<main class="container">
  <section class="layout">
    <aside class="sidebar">
      <div class="sideTitle">Machine</div>
      <div class="machineTabs" id="machineTabs"></div>

      <div class="sideTitle">Categories</div>
      <div id="catList"></div>
    </aside>

    <section class="content">
      <div class="pageTitle">
        <h2 id="categoryTitle">Select a category</h2>
        <div class="small" id="categoryHint">Choose a machine and category on the left. Then pick duty + width and price updates instantly.</div>
      </div>

      <div id="tiles" class="tilesGrid"></div>

      <div class="small" id="status" style="margin-top:12px;color:var(--muted)"></div>
    </section>
  </section>
</main>

<footer>
  <div class="container small">
    Â© Hendo Equipment â€¢ Hendersonville, NC
  </div>
</footer>

<script>
/* ================================
   FULL Excel-driven Configurator
   Data source: /data/hendo_catalog.json
   ================================ */

/* ---------- config ---------- */
const DATA_URL = "./data/hendo_catalog.json";     // put hendo_catalog.json in repo at /data/hendo_catalog.json
const QUOTE_EMAIL = "whoots821@gmail.com";        // change if you want

/* ---------- helpers ---------- */
const escAttr = s => String(s ?? "").replace(/"/g,'&quot;').replace(/</g,'&lt;');
const norm = s => String(s ?? "").toLowerCase().trim();
const money = n => {
  const num = Number(n);
  if (!Number.isFinite(num)) return "â€”";
  return "$" + Math.round(num).toLocaleString();
};
const uniq = arr => [...new Set((arr||[]).filter(v => v !== undefined && v !== null && v !== ""))];
const numericSort = arr => uniq(arr).slice().sort((a,b)=>Number(a)-Number(b));

/* ---------- machine mapping (keeps your sidebar layout) ---------- */
function inferMachine(categoryName){
  const n = norm(categoryName);
  if (n.includes("tractor")) return "Tractor";
  if (n.includes("excavator")) return "Excavator";
  if (n.includes("mini")) return "Mini Skid Steer";
  return "Skid/Track Loader";
}

/* ---------- DOM ---------- */
const machineTabs = document.getElementById("machineTabs");
const catList = document.getElementById("catList");
const tilesEl = document.getElementById("tiles");
const statusEl = document.getElementById("status");
const categoryTitle = document.getElementById("categoryTitle");
const categoryHint = document.getElementById("categoryHint");

/* ---------- state ---------- */
let RAW = null;                 // raw JSON object
let CATEGORIES = [];            // [{ id, label, machine, items }]
let MACHINES = [];              // ["Skid/Track Loader", ...]
let machine = null;             // selected machine
let category = null;            // selected category object

/* ---------- data utils ---------- */
function getVariant(item, duty, width){
  // lookup keys are "Duty|Width" OR "|Width" when duty is null/none
  const d = duty ? String(duty) : "";
  const w = (width === "" || width === null || width === undefined) ? "" : String(width);
  const key = `${d}|${w}`;
  return item.lookup?.[key] || null;
}

function buildCategoriesFromRaw(raw){
  // raw is an object keyed by tab name -> { category, items }
  const cats = Object.entries(raw).map(([tabName, obj]) => {
    const label = obj?.category || tabName;
    const machine = inferMachine(label);
    return {
      id: tabName,
      label,
      machine,
      items: Array.isArray(obj?.items) ? obj.items : []
    };
  });

  // sort categories by label
  cats.sort((a,b)=>a.label.localeCompare(b.label));
  return cats;
}

function buildMachines(categories){
  const set = new Set(categories.map(c => c.machine));
  // Stable order:
  const order = ["Skid/Track Loader", "Mini Skid Steer", "Tractor", "Excavator"];
  return order.filter(m => set.has(m));
}

/* ---------- render ---------- */
function renderMachines(){
  machineTabs.innerHTML = (MACHINES||[]).map(m => `
    <button class="${m===machine ? "active" : ""}" onclick="setMachine('${escAttr(m)}')">${m}</button>
  `).join("");
}

function renderCats(){
  const list = CATEGORIES.filter(c => c.machine === machine);
  catList.innerHTML = list.map(c => `
    <button class="catBtn ${category && category.id===c.id ? "active" : ""}" onclick="setCategory('${escAttr(c.id)}')">
      ${c.label}
    </button>
  `).join("");

  if (!list.length){
    catList.innerHTML = `<div class="small" style="color:var(--muted)">No categories for this machine.</div>`;
  }
}

function makeTile(item){
  const duties = uniq(item?.options?.duty || []).filter(d => norm(d) !== "none");
  const widths = numericSort(item?.options?.width || []);

  // default selections
  let selectedDuty = duties.length ? duties[0] : "";
  let selectedWidth = widths.length ? widths[0] : "";

  const tile = document.createElement("div");
  tile.className = "tile";

  tile.innerHTML = `
    <div class="tileHead">
      <div class="name">${escAttr(item?.name || "Item")}</div>
    </div>
    <div class="tileBody">
      <div class="filters">
        ${duties.length ? `
          <div class="field">
            <label>Duty</label>
            <select class="dutySel">
              ${duties.map(d => `<option value="${escAttr(d)}">${d}</option>`).join("")}
            </select>
          </div>
        ` : ""}
        <div class="field">
          <label>Width (in)</label>
          <select class="widthSel">
            ${widths.map(w => `<option value="${escAttr(w)}">${w}"</option>`).join("")}
          </select>
        </div>
      </div>

      <div>
        <div class="small">Selected SKU</div>
        <div class="skuOut" style="font-weight:900">â€”</div>
      </div>

      <div>
        <div class="small">Price</div>
        <div class="priceOut priceBig">â€”</div>
      </div>

      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn btnPrimary emailBtn" href="#">Email Quote</a>
      </div>
    </div>
  `;

  const dutySel = tile.querySelector(".dutySel");
  const widthSel = tile.querySelector(".widthSel");
  const skuOut = tile.querySelector(".skuOut");
  const priceOut = tile.querySelector(".priceOut");
  const emailBtn = tile.querySelector(".emailBtn");

  function update(){
    const d = dutySel ? dutySel.value : "";
    const w = widthSel ? widthSel.value : "";
    const v = getVariant(item, d, w);

    skuOut.textContent = v?.sku || "â€”";
    priceOut.textContent = v ? money(v.price) : "â€”";

    const subject = encodeURIComponent(`Quote request: ${(item?.name || "Item")} ${v?.sku ? "(" + v.sku + ")" : ""}`);
    const body = encodeURIComponent(
      `Hi Hendo Equipment,\n\n` +
      `Iâ€™d like a quote for:\n` +
      `Category: ${category?.label || ""}\n` +
      `Item: ${item?.name || ""}\n` +
      (d ? `Duty: ${d}\n` : "") +
      (w ? `Width: ${w}"\n` : "") +
      (v?.sku ? `SKU: ${v.sku}\n` : "") +
      (v ? `Price shown: ${money(v.price)}\n` : "") +
      `\nName:\nPhone:\nLocation:\n\nThanks!`
    );

    emailBtn.href = `mailto:${QUOTE_EMAIL}?subject=${subject}&body=${body}`;
  }

  if (dutySel) dutySel.addEventListener("change", update);
  if (widthSel) widthSel.addEventListener("change", update);

  // set defaults in UI
  if (dutySel && selectedDuty) dutySel.value = selectedDuty;
  if (widthSel && selectedWidth) widthSel.value = String(selectedWidth);

  update();
  return tile;
}

function renderTiles(){
  tilesEl.innerHTML = "";
  if (!category){
    categoryTitle.textContent = "Select a category";
    categoryHint.textContent = "Choose a machine and category on the left. Then pick duty + width and price updates instantly.";
    statusEl.textContent = "";
    return;
  }

  categoryTitle.textContent = category.label;
  categoryHint.textContent = "Pick duty + width. Price updates instantly.";

  const items = Array.isArray(category.items) ? category.items : [];
  if (!items.length){
    statusEl.textContent = "No items found in this category.";
    return;
  }

  items.forEach(item => tilesEl.appendChild(makeTile(item)));
  statusEl.textContent = `Showing ${items.length} item${items.length===1?"":"s"}.`;
}

function render(){
  renderMachines();
  renderCats();
  renderTiles();
}

/* ---------- actions ---------- */
function setMachine(m){
  machine = m;
  category = null;

  // remember
  try { localStorage.setItem("hendo_machine", machine); } catch(e){}

  render();
}

function setCategory(id){
  category = CATEGORIES.find(c => c.id === id) || null;

  // remember
  try { localStorage.setItem("hendo_category", category?.id || ""); } catch(e){}

  render();
}

/* ---------- init ---------- */
(async function init(){
  statusEl.textContent = "Loading catalogâ€¦";

  try{
    const res = await fetch(DATA_URL, { cache: "no-store" });
    if(!res.ok) throw new Error(`Failed to load ${DATA_URL} (HTTP ${res.status})`);
    RAW = await res.json();

    // RAW is keyed by tab names. All_Items is not included in this JSON.
    CATEGORIES = buildCategoriesFromRaw(RAW);
    MACHINES = buildMachines(CATEGORIES);

    // restore selections if possible
    let savedMachine = null;
    let savedCategory = null;
    try{
      savedMachine = localStorage.getItem("hendo_machine");
      savedCategory = localStorage.getItem("hendo_category");
    }catch(e){}

    machine = (savedMachine && MACHINES.includes(savedMachine)) ? savedMachine : (MACHINES[0] || "Skid/Track Loader");

    // if saved category belongs to current machine, select it; otherwise pick first in machine
    const catsForMachine = CATEGORIES.filter(c => c.machine === machine);
    if (savedCategory && catsForMachine.some(c => c.id === savedCategory)){
      category = catsForMachine.find(c => c.id === savedCategory);
    } else {
      category = catsForMachine[0] || null;
    }

    statusEl.textContent = "";
    render();
  }catch(err){
    console.error(err);
    statusEl.textContent = `Could not load catalog JSON. Put hendo_catalog.json in /data and verify path: ${DATA_URL}. Error: ${err.message || err}`;
  }
})();
</script>
</body>
</html>
